---

- name: Install Syncthing
  homebrew:
    name: syncthing
    state: present
  become: false
  ignore_errors: true

- name: start syncthing as service
  command: brew services start syncthing
  register: syncthing_service_status
  ignore_errors: yes
  become: false
  
# - find:
#     paths: "{{ homebrew_install_path }}"
#     patterns: "*.syncthing.plist"
#     recurse: yes
#   register: syncthing_plist_path
#   become: false
#
# - debug:
#     msg: "{{ syncthing_plist_path.files[0]['path'] }}"
#
# - copy:
#     src: "{{ syncthing_plist_path.files[0]['path'] }}"
#     dest: "{{ home }}/Library/LaunchAgents/syncthing.plist"
#     owner: root
#     group: wheel
#     mode: 0644
#   when: become_skip is not defined or not become_skip
#   become: true
#
# - command: "launchctl load {{ home }}/Library/LaunchAgents/syncthing.plist"
#   when: become_skip is not defined or not become_skip
#   become: true
