---

- name: ensure .zshrc exists
  stat:
    path: "{{ home }}/.zshrc"
  register: z

- name: create .zshrc if not exists
  file:
    path: "{{ home }}/.zshrc"
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    mode: 0644
    state: '{{ "file" if z.stat.exists else "touch" }}'

- lineinfile:
    dest: "{{ home }}/.zshrc"
    state: present
    line: "{{ zsh_init_div }}"
  become: false

- name: Install zsh Powerline Theme
  get_url:
    url: "{{ zsh_powerline_url }}"
    dest: "{{ roles_dir }}/zsh/files/{{ zsh_powerline_file }}"
    mode: 0644
    force: yes
    backup: yes
  ignore_errors: true
  become: false

- lineinfile:
    dest: "{{ home }}/.zshrc"
    state: present
    line: "{{ zsh_powerline_div }}"
  become: false

- file:
    src: "{{ roles_dir }}/zsh/files/{{ zsh_powerline_adrw_file }}"
    dest: "{{ home }}/{{ zsh_powerline_adrw_file }}"
    state: link
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    mode: 0644
    force: yes
  become: false

- file:
    path: "{{ home }}/.zshrc"
    state: touch
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
    mode: 0644
  become: false

- lineinfile:
    dest: "{{ home }}/.zshrc"
    state: present
    line: "{{ zsh_powerline_source }}"
  become: false
